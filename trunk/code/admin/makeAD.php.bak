<?php
/**
 * 广告生成模块
 * @author xiongzhixin (xzx747@sohu.com) 2007-08-04
 */
 //define("OPEN_DEBUG",true);
$sAction = (isset($_GET["act"])) ? $_GET["act"] : "listAll";
require_once("../class/common.inc.php");

checkExecPower("makeAD", $sAction);		//权限检查
loadLib("channel");	

if($sAction == "listAll")
{
	$tpl->display("html/makeAD_list.tpl.htm");
}
elseif($sAction == "doMakeNews_bottom_ad") // 资讯终端页底部广告生成
{		
	$aList = channel::getWebUrlByChannelID(2,"-1");
	//print_r($aList);exit;
	$sStr = "";
	for($i=0; $i<count($aList); $i++)
	{
		$iIsRed = $aList[$i]['isRed'];
		$sTitle = $aList[$i]['adTitle'];
		$sNewTitle = ($iIsRed==1) ? "<font color=red>$sTitle</font>" : $sTitle ;
		$sUrl = $aList[$i]['adWebPage'];
		if($i % 6 == 0)
		{
			$sPic = ($aList[$i]['pic']) ? "/adPic/".$aList[$i]['pic'] : "/img_test/no_pic80.gif";
			$sStr .= "<div class=\"mobotcpt_e\"><p><a href=\"{$sUrl}\" target=\"_blank\" title=\"{$sTitle}\"><img src=\"{$sPic}\" alt=\"\" width=108 height=80></a></p><ul>";
		}	
		else	
		{
			$sStr .= "<li><a href=\"{$sUrl}\" title=\"{$sTitle}\" target=\"_blank\">{$sNewTitle}</a></li>";		
			if(($i+1) % 6 == 0) $sStr .= "</ul></div>";
		}
	}
	$sStr = "document.write('{$sStr}');";
	$fp = fopen("../js/news_bottom_ad.js","w+");
	if(fwrite($fp,$sStr))
		redirect("makeAD.php",3,"生成成功！");
	else 
		redirect("makeAD.php",5,"生成失败！");
}
elseif($sAction == "doMakeNews_right_ad1") // 资讯终端页右侧广告一生成
{		
	$aList = channel::getWebUrlByChannelID(3);
	//print_r($aList);exit;
	$sStr = "";
	for($i=0; $i<count($aList); $i++)
	{
		$iIsRed = $aList[$i]['isRed'];
		$sTitle = $aList[$i]['adTitle'];
		$sNewTitle = ($iIsRed==1) ? "<font color=red>$sTitle</font>" : $sTitle ;
		$sUrl = $aList[$i]['adWebPage'];
		if($i <= 5) // 文字
		{
			if($i == 0) $sStr .= "<ul class=\"mocpqylist\">";
			$sStr .= "<li><a href=\"{$sUrl}\" title=\"{$sTitle}\" target=\"_blank\">{$sNewTitle}</a></li>";		
			if($i == 5) $sStr .= "</ul>";
		}	
		else	// 图片
		{
			if($i == 6) $sStr .= "<ul class=\"mocpqypic\">";
			$sPic = ($aList[$i]['pic']) ? "/adPic/".$aList[$i]['pic'] : "/img_test/no_pic76.gif";
			$sStr .= "<li><a href=\"{$sUrl}\" target=\"_blank\" title=\"{$sTitle}\"><img src=\"{$sPic}\" alt=\"\" width=103 height=76></a></li>";
			if($i == 9) $sStr .= "</ul>";
		}
	}
	$sStr = "document.write('{$sStr}');";
	$fp = fopen("../js/news_right_ad1.js","w+");
	if(fwrite($fp,$sStr))
		redirect("makeAD.php",3,"生成成功！");
	else 
		redirect("makeAD.php",5,"生成失败！");
}
elseif($sAction == "doMakeNews_right_ad2") // 资讯终端页右侧广告二生成
{		
	$aList = channel::getWebUrlByChannelID(4);	
	$sStr = "";
	for($i=0; $i<count($aList); $i++)
	{
		$iIsRed = $aList[$i]['isRed'];
		$sTitle = $aList[$i]['adTitle'];
		$sNewTitle = ($iIsRed==1) ? "<font color=red>$sTitle</font>" : $sTitle ;
		$sUrl = $aList[$i]['adWebPage'];
		$sStr .= "<li><a href=\"{$sUrl}\" title=\"{$sTitle}\" target=\"_blank\">{$sNewTitle}</a></li>";		
	}
	$sStr = "document.write('{$sStr}');";
	$fp = fopen("../js/news_right_ad2.js","w+");
	if(fwrite($fp,$sStr))
		redirect("makeAD.php",3,"生成成功！");
	else 
		redirect("makeAD.php",5,"生成失败！");
}
elseif($sAction == "doMakeNews_channel_bottom_ad") // 资讯频道页底部广告生成
{		
	$aList = channel::getWebUrlByChannelID(5);
	//print_r($aList);exit;
	$sStr = "";
	for($i=0; $i<count($aList); $i++)
	{
		$iIsRed = $aList[$i]['isRed'];
		$sTitle = $aList[$i]['adTitle'];
		$sNewTitle = ($iIsRed==1) ? "<font color=red>$sTitle</font>" : $sTitle ;
		$sUrl = $aList[$i]['adWebPage'];
		$sPic = ($aList[$i]['pic']) ? "/adPic/".$aList[$i]['pic'] : "/img_test/bjphoto.jpg";
		$sStr .= "<li><p><a href=\"{$sUrl}\" target=\"_blank\" title=\"{$sTitle}\"><img src=\"{$sPic}\" alt=\"\" width=108 height=80></a></p><span><a href=\"{$sUrl}\" target=\"_blank\" title=\"{$sTitle}\">{$sNewTitle}</a></span></li>";
	}
	$sStr = "document.write('{$sStr}');";
	$fp = fopen("../js/news_channel_bottom_ad.js","w+");
	if(fwrite($fp,$sStr))
		redirect("makeAD.php",3,"生成成功！");
	else 
		redirect("makeAD.php",5,"生成失败！");
}
elseif($sAction == "doMakeIndex_top_ad") // 首页头部滚动广告生成
{		
	$aList = channel::getWebUrlByChannelID(8);
	
//print_r($aList);exit;
	$sStr = "<marquee onmouseover=stop() onmouseout=start() scrollAmount=3 direction=left loop=infinite width=320 deplay=\"0\">";
			
	for($i=0; $i<count($aList); $i++)
	{
		$iIsRed = $aList[$i]['isRed'];
		$sTitle = $aList[$i]['adTitle'];
		$sNewTitle = ($iIsRed==1) ? "<font color=red>$sTitle</font>" : $sTitle ;
		$sUrl = $aList[$i]['adWebPage'];		
		$sStr .= "<a href=\"{$sUrl}\" target=\"_blank\" title=\"{$sTitle}\">{$sNewTitle}</a> ";
	}
	
	$sStr .= "</marquee>";
	
	$sStr = "document.write('{$sStr}');";
	$fp = fopen("../js/index_top_ad.js","w+");
	if(fwrite($fp,$sStr))
		redirect("makeAD.php",3,"生成成功！");
	else 
		redirect("makeAD.php",5,"生成失败！");
}
elseif($sAction == "doMakeIndex_product_ad") // 首页产品博览文字链广告生成
{		
	$aList = channel::getWebUrlByChannelID(9);
	//print_r($aList);exit;
	$sStr = "";
			
	for($i=0; $i<count($aList); $i++)
	{
		$iIsRed = $aList[$i]['isRed'];
		$sTitle = $aList[$i]['adTitle'];
		$sNewTitle = ($iIsRed==1) ? "<font color=red>$sTitle</font>" : $sTitle ;
		$sUrl = $aList[$i]['adWebPage'];		
		$sStr .= "<a href=\"{$sUrl}\" target=\"_blank\" title=\"{$sTitle}\">{$sNewTitle}</a> ";
	}
	
	$sStr = "document.write('{$sStr}');";
	$fp = fopen("../js/index_product_ad.js","w+");
	if(fwrite($fp,$sStr))
		redirect("makeAD.php",3,"生成成功！");
	else 
		redirect("makeAD.php",5,"生成失败！");
}
elseif($sAction == "doMakeComplaint_ad") // 投诉曝光广告
{
	$aAD = array(11,12,13,14); // 右侧广告一，右侧广告二，右侧广告三，底部广告
	$aADFile = array("complaint_right_ad1.js","complaint_right_ad2.js","complaint_right_ad3.js","complaint_bottom_ad.js");
	
	for($i=0; $i<count($aAD); $i++)
	{	
		$iID = $aAD[$i];
		$sFileName = $aADFile[$i];		
		$aList = channel::getWebUrlByChannelID($iID);
		//if($i==3) print_r($aList);
		$sStr = "";		
		
		//echo "<br>".$iID."&&&".$sFileName."<br>";
		
		for($j=0; $j<count($aList); $j++)
		{
			$iIsRed = $aList[$j]['isRed'];
			$sTitle = $aList[$j]['adTitle'];
			//$sPic = $aList[$j]['pic'];
			$sPic = ($aList[$j]['pic']) ? "/adPic/".$aList[$j]['pic'] : "/img_test/no_pic80.gif";
			$sNewTitle = ($iIsRed==1) ? "<font color=red>$sTitle</font>" : $sTitle ;
			$sUrl = $aList[$j]['adWebPage'];
			if($i == 0 || $i == 2) // 右侧广告一，右侧广告三
				$sStr .= "<li>・<a href=\"{$sUrl}\" target=\"_blank\" title=\"{$sTitle}\">{$sNewTitle}</a></li>";
			elseif($i == 1)	// 右侧广告二
			{
				$sStr .= ($j==0) ? "<ul class=\"mocpqylist\">" : "";
				$sStr .= ($j <= 5) ? "<li>・<a href=\"{$sUrl}\" target=\"_blank\" title=\"{$sTitle}\">{$sNewTitle}</a></li>" :				
				 "<li><a href=\"{$sUrl}\" target=\"_blank\" title=\"{$sTitle}\"><img src=\"{$sPic}\"  width=103 height=76></a></li>";
				$sStr .= ($j == 5) ? "</ul><ul class=\"mocpqypic\">" : "";
				$sStr .= ($j == 9) ? "</ul>" : "";
			}
			elseif($i == 3) // 底部广告
			{				
				$sStr .= "<li><p><a href=\"{$sUrl}\" target=\"_blank\" title=\"{$sTitle}\"><img src=\"{$sPic}\"  width=108 height=80></a></p><span><a href=\"{$sUrl}\" target=\"_blank\" title=\"{$sTitle}\">{$sNewTitle}</a></span></li>";
			}
		}	
		
		$sStr = "document.write('{$sStr}');";
		//echo $sStr;exit;
		$fp = fopen("../js/".$sFileName,"w+");		
		fwrite($fp,$sStr);			
	}
	redirect("makeAD.php",3,"生成成功！");
}
elseif($sAction == "doMakeList_ad")
{
	$aList = channel::getWebUrlByChannelID(22);
	//print_r($aList);exit;
	$sStr = "";
			
	for($i=0; $i<count($aList); $i++)
	{
		$iIsRed = $aList[$i]['isRed'];
		$sTitle = $aList[$i]['adTitle'];
		$sNewTitle = ($iIsRed==1) ? "<font color=red>$sTitle</font>" : $sTitle ;
		$sUrl = $aList[$i]['adWebPage'];		
		$sStr .= "<li>・<a href=\"{$sUrl}\" target=\"_blank\" title=\"{$sTitle}\">{$sNewTitle}</a></li>";
	}
	
	$sStr = "document.write('{$sStr}');";
	$fp = fopen("../js/list_ad.js","w+");
	if(fwrite($fp,$sStr))
		redirect("makeAD.php",3,"生成成功！");
	else 
		redirect("makeAD.php",5,"生成失败！");
}
else 
{	
	showError("参数错误！");
}
?>